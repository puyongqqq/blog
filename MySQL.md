### MySQL基础总结

1. MyISAM 和 InnoDB的区别

   |           | MyISAM                                   | InnoDB                |
   | --------- | ---------------------------------------- | --------------------- |
   | 事务      | 不支持                                   | 支持                  |
   | 外键      | 不支持                                   | 支持                  |
   | 索引类型  | 非聚集索引                               | 聚集索引              |
   | 锁粒度    | 表锁                                     | 行锁                  |
   | count函数 | 会给每张表维护一个count字段（不加where） | 慢（全表扫描）        |
   | 其他      | 5.5之前默认存储引擎                      | 5.5之后的默认存储引擎 |

   MyISAM常作为`SELECT`较多时的一种数据库存储引擎，不支持事务，不支持外键，非聚集索引，内部会为维护表的一个count值。每张表在磁盘上存储成三个文件。`.frm`文件存储表定义，`.myd`文件存储元数据，`.myi`文件存储索引数据。因为是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的，默认表锁，所以并发读也低。

   InnoDB因其支持事务和行锁，并发性能高，在MySQL5.5被作为其默认的存储引擎。主键索引默认为聚集索引。InnoDB还支持`redo log`，对数据完整性也是可保障的（`crash-safe`）。

   > 默认情况下，InnoDB存储引擎不会回滚超时引发的异常，除死锁外。

2. 锁的分类。

   1. 记录锁（Record Locks）。（RD，RR，S）

      锁直接加在索引记录上面（无索引项时演变成**表锁**）。

   2. 间隙锁（Gap Locks）。（RR）

      锁定索引记录间隙，确保索引记录的间隙不变。间隙锁是针对事务隔离级别为可重复读或以上级别的。

   3. 行间锁（Next-Key Locks）。（RR）

      对记录锁和间隙锁的组合，既锁住行也锁住间隙。并且采用的左开右闭`(x, y]`的原则，InnoDB 对于查询都是采用这种锁的。其解决了幻读。

   4. 表锁。

      表锁就是将一整张表加锁，在表被锁定期间，其他事务不能对该表进行更新操作，必须等当前表的锁被释放后才能进行操作。

3. MVCC。

4. 一条update语句的执行过程。

5. Buffer Pool。

6. 索引失效场景。

7. 主备延迟问题及解决。
